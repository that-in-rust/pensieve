# Warp Agent Discovery Note: `pensieve` Project (`.kiro/` Directory Analysis) - 2025-09-24 08:12:02

This document provides a Minto Pyramid-style summary of the `.kiro/` directory, which contains the complete design and engineering philosophy for the `pensieve` project. It is intended to guide future development, whether by human or AI agents.

## Level 1: The Core Principle

**The `.kiro/` directory establishes a rigorous, multi-layered framework for building the `pensieve` project, centered on the core philosophy of "Executable Specifications over Narratives."** This TDD-first methodology is designed to guide both human and AI developers, ensuring high-quality, performant, and bug-free code by transforming ambiguous requirements into formal, testable contracts. The entire system is engineered to provide an LLM with a precise, verifiable blueprint, shifting its role from an "interpreter" of vague instructions to a "translator" of an algorithmic plan.

## Level 2: Key Supporting Pillars

The core principle is supported by three main pillars that define the project's development process:

#### 1. **A Rigorous Specification-to-Implementation Workflow**

The project follows a structured, top-down process that cascades from high-level goals to concrete implementation tasks. This ensures every line of code is traceable back to a specific requirement and is validated by automated tests.

- **L1: System Constraints (`.kiro/steering/`):** Defines global, non-negotiable architectural principles, performance contracts, and quality standards that govern the entire system.
- **L2: Architectural Blueprints (`.kiro/specs/.../design.md`):** Translates requirements into a formal architectural design, specifying data models (SQL DDL), component interfaces (Rust traits), and error hierarchies.
- **L3: Module-Level Contracts (`.kiro/specs/.../tasks.md`):** Breaks down the architecture into discrete implementation tasks, each following the **STUB → RED → GREEN → REFACTOR** cycle of Test-Driven Development.
- **L4: End-to-End Validation:** Ensures that all technically correct components integrate to deliver the intended user-facing functionality.

#### 2. **Non-Negotiable TDD-First Architecture Principles**

The project is built on a set of nine "non-negotiable" architectural principles that are strictly enforced to prevent common failures in Rust systems.

- **Layered Rust Architecture (L1→L2→L3):** A clear separation of concerns between Core (no_std, foundational), Standard (collections, iterators), and External (async, third-party crates) idioms.
- **Dependency Injection for Testability:** All components depend on traits, not concrete types, allowing for mock implementations and isolated testing.
- **RAII for Resource Management:** All resources are automatically managed via `Drop` implementations to prevent leaks.
- **Test-Validated Performance Claims:** Every performance assertion (e.g., "query takes <500μs") is backed by an automated test.
- **Structured Error Handling:** Uses `thiserror` for library error hierarchies and `anyhow` for application-level context.

#### 3. **Pragmatic Formalism Optimized for AI Development**

The framework avoids the high overhead of traditional formal methods by using the Rust language itself as a tool for formal specification. This approach is designed to provide an LLM with unambiguous, machine-readable instructions.

- **Rust as a Specification Language:** The strong type system, traits, and error-handling enums are used to create precise, formal contracts that eliminate ambiguity.
- **TDD as a Communication Protocol:** The RED (failing) test suite serves as the perfect, unambiguous communication protocol for an LLM, defining the exact expected inputs, outputs, and side effects.
- **From Interpreter to Translator:** This methodology transforms the LLM from an "interpreter" of vague user stories into a "translator" of a precise, executable blueprint.

## Level 3: Foundational Details and Artifacts

The pillars described above are built upon a foundation of specific documents and artifacts within the `.kiro/` directory:

- **Foundational Philosophy (`.kiro/steering/design101-tdd-architecture-principles.md`):** This is the "bible" of the project. It introduces the core concepts of Executable Specifications, the 9 Architectural Principles, and the L1-L4 development workflow. It provides extensive examples and anti-patterns to avoid.

- **Theoretical Underpinnings (`.kiro/rust-idioms/Executable Specifications for LLM Code Generation.md`):** This document grounds the project's methodology in established computer science principles, such as Design by Contract (DbC) and pragmatic formal methods, providing the "why" behind the "how."

- **Project-Specific Specifications (`.kiro/specs/pensieve-cli-tool/`):** This directory contains the concrete application of the framework to the `pensieve` CLI tool:
    - **`requirements.md`:** Translates user stories into testable "WHEN...THEN...SHALL" acceptance criteria, defining the functional and non-functional requirements.
    - **`design.md`:** Provides the high-level design, including the system architecture, component interfaces, database schema, and processing flow, directly implementing the principles from the `design101` document.
    - **`tasks.md`:** Breaks down the design into a checklist of concrete, ordered implementation tasks.

- **Code and Style Consistency (`.kiro/steering/code-conventions.md` and `.kiro/steering/mermaid-*.md`):** These files ensure consistency across the project, providing rules for code formatting, naming conventions, and the syntax for creating Mermaid diagrams, which are required for all architectural visuals.
